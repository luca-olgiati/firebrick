<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>World WMS Example</title>
<link rel="stylesheet" href="../../libraries/OpenLayers-2.13.1/theme/default/style.css" type="text/css">

<script src="../../libraries/OpenLayers-2.13.1/OpenLayers.js"></script>

<!-- script src="http://openlayers.org/api/OpenLayers.js"></script -->

<!-- script src="../../libraries/OpenLayers/OpenLayers.debug.js"></script -->
<script src="../../libraries/proj4js/proj4js-combined.js"></script>
<script src="../../libraries/proj4js/defs/EPSG21781.js"></script>
<script src="../../libraries/proj4js/util/MGRS.js"></script>
<script src="../../libraries/jquery-2.1.0.min.js"></script>
<script src="../../scripts/RandomEtc-shapefile-js/lib/binaryajax.js"></script>
<script src="../../scripts/RandomEtc-shapefile-js/src/binarywrapper.js"></script>
<script src="../../scripts/RandomEtc-shapefile-js/src/shapefile.js"></script>
<script src="../../scripts/RandomEtc-shapefile-js/src/dbf.js"></script>
<script src="../../scripts/RandomEtc-shapefile-js/src/ol_shapefile.js"></script>

<script type="text/javascript">



	var map;
        		/* A convenient function that add vector layers to the map. */
	function addVectorLayer(map, name, url, opts) {
		var layer = new OpenLayers.Layer.Vector(name, opts);
		getOpenLayersFeatures(url, function(vectors) {
			
			layer.addFeatures(vectors);
			
			
			
			
		});
		//map.addLayer(layer);
		return layer;
	}
	
            function init(){
			
				OpenLayers.IMAGE_RELOAD_ATTEMPTS = 3; 
				OpenLayers.Util.onImageLoadErrorColor = "transparent";
				var options = {
					div: 'map',
					maxResolution: "auto",
					numZoomLevels: 4,
					maxExtent: new OpenLayers.Bounds(-25.67, 21.5, 51.55, 71.05),
					restrictedExtent: new OpenLayers.Bounds(-25.67, 21.5, 51.55, 71.05),

				};
				
                map = new OpenLayers.Map(options);
				

                var day= new OpenLayers.Layer.WMS("Day", "http://karlinapp.ethz.ch/cgi-bin/qgis_map_server/europa_diagram/qgis_mapserv.fcgi?", {layers: 'land_ocean_ice', styles: 'default', format: 'image/png', SRS: 'EPSG4258' },{tileSize: new OpenLayers.Size(512,512), buffer: 1 });
				var elev= new OpenLayers.Layer.WMS("Elevation", "http://demo.cubewerx.com/demo/cubeserv/cubeserv.cgi?CONFIG=main&", {layers: 'Foundation.Gtopo30', styles: 'default', format: 'image/png', SRS: 'EPSG4258' },{tileSize: new OpenLayers.Size(512,512), buffer: 1 });
				
				
					var polygons=addVectorLayer(map, "europe", 'shapefiles/europe_1', { styleMap: new OpenLayers.StyleMap({
						"default": new OpenLayers.Style({
							strokeColor: "#FE9A2E",
							strokeOpacity: 1,
							strokeWidth: 1,
							fillColor: "#FE9A2E",
							fillOpacity: 0.5,
							//cursor: "pointer",			
						}),
						"temporary": new OpenLayers.Style({
							strokeColor: "#FE9A2E",
							strokeOpacity: 1,
							strokeWidth: 1,
							fillColor: "#FE9A2E",
							fillOpacity: .8,
							//cursor: "pointer",
							//label: "${Full_name}", //perhaps: http://gis.stackexchange.com/questions/29584/openlayers-attribute-substitution-failing-on-kml-file
							//label: "Testtext",
							//labelAlign: "cc",
							fontColor: "#FFFFFF",
							fontOpacity: 1,
							fontFamily: "Arial",
							fontSize: 24
							
						}),
						"select": new OpenLayers.Style({
							strokeColor: "#FE9A2E",
							strokeOpacity: 1,
							strokeWidth: 1,
							fillColor: "#FF0000",
							fillOpacity: 0.5,
							graphicZIndex: 2,
							//cursor: "pointer"
						})
					}),displayInLayerSwitcher: false,
					});
				
				var strategy = new OpenLayers.Strategy.Cluster({distance: 20, threshold: 2});
                var layer_winter = new OpenLayers.Layer.Vector("Winter Locations", {
                    strategies: [new OpenLayers.Strategy.BBOX({resFactor: 1.1}),strategy],
                    protocol: new OpenLayers.Protocol.HTTP({
                        url: "points_europe_winter.txt",
                        format: new OpenLayers.Format.Text()
                    }),
					styleMap: new OpenLayers.StyleMap({"default": new OpenLayers.Style({
							pointRadius: 10,
							fillColor: "#4444FF",
							fillOpacity: 0.8,
							strokeColor: "#4444FF",
							strokeWidth: 1,
							strokeOpacity: 0.8

							})}
					)
                });
			
				var strategy2 = new OpenLayers.Strategy.Cluster({distance: 20, threshold: 2});
                
                var layer_summer = new OpenLayers.Layer.Vector("Summer Locations", {
                    strategies: [new OpenLayers.Strategy.BBOX({resFactor: 1.1}),strategy2],
                    protocol: new OpenLayers.Protocol.HTTP({
                        url: "points_europe_summer.txt",
                        format: new OpenLayers.Format.Text()
                    }),
					styleMap: new OpenLayers.StyleMap({"default": new OpenLayers.Style({
							pointRadius: 10,
							fillColor: "#FF4444",
							fillOpacity: 0.8,
							strokeColor: "#FF4444",
							strokeWidth: 1,
							strokeOpacity: 0.8

							})}
					)
                });
				
				
				
				
				
				
				
				
                map.addLayers([day,elev,polygons,layer_winter,layer_summer]);
                map.zoomToMaxExtent();
				map.addControl(new OpenLayers.Control.LayerSwitcher());
				
                // Interaction; not needed for initial display.
                selectControl = new OpenLayers.Control.SelectFeature([layer_winter,layer_summer,polygons]);
                map.addControl(selectControl);
                selectControl.activate();
                
				layer_summer.events.on({
                    'featureselected': onFeatureSelect,
                    'featureunselected': onFeatureUnselect,
					clickout: true,
                });
			layer_winter.events.on({
                    'featureselected': onFeatureSelect,
                    'featureunselected': onFeatureUnselect,
					clickout: true,
                });
			
			var highlightCtrl = new OpenLayers.Control.SelectFeature(polygons, {
					hover: true,
					//onSelect: onFeatureSelect, onUnselect: onFeatureUnselect,
					highlightOnly: true,
					renderIntent: "temporary",
				}
				);
			
				map.addControl(highlightCtrl);
				highlightCtrl.activate();
			/*	
			var selectControl2 = new OpenLayers.Control.SelectFeature(polygons, {
					//hover: true,
					onSelect: onFeatureSelect, onUnselect: onFeatureUnselect,
					//highlightOnly: true,
					renderIntent: "select",
				}
				);
			
				map.addControl(selectControl2);
				selectControl2.activate();
				*/
			/*	
				var highlightCtrl = new OpenLayers.Control.SelectFeature(polygons, {
					hover: true,// onSelect: onFeatureSelect, onUnselect: onFeatureUnselect,
					highlightOnly: true,
					renderIntent: "temporary",
				}
				);
				*/
            } // init finished
             
			
			// interaction of points
			
            // Needed only for interaction, not for the display.
            function onPopupClose(evt) {
                // 'this' is the popup.
                var feature = this.feature;
                if (feature.layer) { // The feature is not destroyed
                    selectControl.unselect(feature);
                } else { // After "moveend" or "refresh" events on POIs layer all 
                         //     features have been destroyed by the Strategy.BBOX
                    this.destroy();
                }
            }
            function onFeatureSelect(evt) {
                feature = evt.feature;
				if (feature.cluster) {
										var cc=	"<h2>"+feature.cluster.length+" Locations here</h2>"
										 }else {
                                         var cc="<h2>"+feature.attributes.title + "</h2>" +feature.attributes.description};
										 
                popup = new OpenLayers.Popup.FramedCloud("featurePopup",
                                         feature.geometry.getBounds().getCenterLonLat(),
                                         null,//new OpenLayers.Size(100,100),
                                         cc,
                                         null, true, onPopupClose);
                feature.popup = popup;
                popup.feature = feature;
                map.addPopup(popup, true);
            }
            function onFeatureUnselect(evt) {
                feature = evt.feature;
                if (feature.popup) {
                    popup.feature = null;
                    map.removePopup(feature.popup);
                    feature.popup.destroy();
                    feature.popup = null;
                }
            }
			
			// end interaction of points
			
			
			
			
			
			
			
</script>

</head>
<body onload="init()">
<div id="map" style="position:absolute;left:0;top:0;right:0;bottom:0"></div>
         
</body>
</html>
